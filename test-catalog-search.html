<!DOCTYPE html>
<html>
<head>
    <title>Test Catalog Search</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        input { padding: 5px; margin: 10px 0; width: 300px; }
        button { padding: 5px 10px; margin: 0 5px; }
        #results { margin-top: 20px; padding: 10px; background: #f0f0f0; }
        .result-item { padding: 5px; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>Test Catalog Search</h1>
    
    <h2>Medication Search</h2>
    <input type="text" id="medSearch" placeholder="Type medication name..." />
    <button onclick="searchMedications()">Search</button>
    <div id="medResults"></div>
    
    <h2>Condition Search</h2>
    <input type="text" id="condSearch" placeholder="Type condition name..." />
    <button onclick="searchConditions()">Search</button>
    <div id="condResults"></div>
    
    <script>
        async function searchMedications() {
            const query = document.getElementById('medSearch').value;
            const url = `http://localhost:8000/api/catalogs/medications?search=${encodeURIComponent(query)}&limit=10`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                let html = `<h3>Results (${data.length} items):</h3>`;
                data.forEach(item => {
                    html += `<div class="result-item">
                        <strong>${item.generic_name || item.display || 'Unknown'}</strong><br>
                        Code: ${item.rxnorm_code || item.id}<br>
                        ${item.strength ? `Strength: ${item.strength}` : ''}
                    </div>`;
                });
                
                document.getElementById('medResults').innerHTML = html;
            } catch (error) {
                document.getElementById('medResults').innerHTML = `<div style="color: red;">Error: ${error}</div>`;
            }
        }
        
        async function searchConditions() {
            const query = document.getElementById('condSearch').value;
            const url = `http://localhost:8000/api/catalogs/conditions?search=${encodeURIComponent(query)}&limit=10`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                let html = `<h3>Results (${data.length} items):</h3>`;
                data.forEach(item => {
                    html += `<div class="result-item">
                        <strong>${item.display_name || item.display || 'Unknown'}</strong><br>
                        ICD-10: ${item.icd10_code || item.code || 'N/A'}<br>
                        ${item.category ? `Category: ${item.category}` : ''}
                    </div>`;
                });
                
                document.getElementById('condResults').innerHTML = html;
            } catch (error) {
                document.getElementById('condResults').innerHTML = `<div style="color: red;">Error: ${error}</div>`;
            }
        }
        
        // Auto-search on keyup
        document.getElementById('medSearch').addEventListener('keyup', (e) => {
            if (e.target.value.length >= 2) {
                searchMedications();
            }
        });
        
        document.getElementById('condSearch').addEventListener('keyup', (e) => {
            if (e.target.value.length >= 2) {
                searchConditions();
            }
        });
    </script>
</body>
</html>