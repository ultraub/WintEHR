# FHIR Data Reference Guide

This document provides a comprehensive reference for FHIR data available in the WintEHR system after loading Synthea-generated patient data.

**Last Updated**: 2025-01-20  
**Location**: backend/scripts/testing/FHIR_DATA_REFERENCE.md

## üè• Overview

WintEHR uses Synthea (Synthetic Patient Generator) to create realistic FHIR R4 patient data. This data includes:
- Complete patient demographics
- Medical history spanning 10 years
- Encounters (ambulatory, emergency, inpatient)
- Conditions (diagnoses)
- Medications
- Observations (labs, vitals)
- Procedures
- Immunizations
- Allergies
- Care plans

## üìä FHIR Resource Types Generated by Synthea

### Core Administrative Resources
| Resource Type | Description | Typical Count per Patient |
|--------------|-------------|--------------------------|
| **Patient** | Patient demographics | 1 |
| **Practitioner** | Healthcare providers | 5-10 total |
| **Organization** | Healthcare facilities | 3-5 total |
| **Location** | Physical locations | 3-5 total |

### Clinical Resources
| Resource Type | Description | Typical Count per Patient |
|--------------|-------------|--------------------------|
| **Encounter** | Clinical visits | 10-50 |
| **Condition** | Diagnoses/problems | 5-20 |
| **Observation** | Labs, vitals, social history | 50-200 |
| **Procedure** | Medical procedures | 5-15 |
| **MedicationRequest** | Prescriptions | 10-30 |
| **Immunization** | Vaccination records | 10-20 |
| **AllergyIntolerance** | Allergies | 0-3 |
| **CarePlan** | Treatment plans | 2-10 |

### Diagnostic Resources
| Resource Type | Description | Typical Count per Patient |
|--------------|-------------|--------------------------|
| **DiagnosticReport** | Lab/imaging reports | 10-30 |
| **Observation** | Lab results | Included above |
| **ImagingStudy** | Medical imaging | 0-5 (requires DICOM generation) |

### Financial Resources
| Resource Type | Description | Typical Count per Patient |
|--------------|-------------|--------------------------|
| **Claim** | Insurance claims | 10-50 |
| **ExplanationOfBenefit** | Claim details | 10-50 |

## üîç Common Search Patterns

### Patient Searches
```http
# Search by name
GET /fhir/R4/Patient?name=Smith

# Search by birthdate
GET /fhir/R4/Patient?birthdate=1970-01-01

# Search by identifier
GET /fhir/R4/Patient?identifier=12345
```

### Clinical Resource Searches
```http
# Get all conditions for a patient
GET /fhir/R4/Condition?patient=Patient/123

# Get active medications
GET /fhir/R4/MedicationRequest?patient=Patient/123&status=active

# Get recent observations
GET /fhir/R4/Observation?patient=Patient/123&date=ge2024-01-01

# Get vital signs
GET /fhir/R4/Observation?patient=Patient/123&category=vital-signs
```

### Bundle Operations
```http
# Get everything for a patient
GET /fhir/R4/Patient/123/$everything

# Get specific resource types
GET /fhir/R4/Patient/123/$everything?_type=Condition,MedicationRequest,Observation
```

## üß™ Testing Data Characteristics

### Observation Categories
Synthea generates observations in these categories:
- **vital-signs**: Blood pressure, heart rate, temperature, weight, height, BMI
- **laboratory**: CBC, metabolic panel, lipid panel, glucose, HbA1c
- **social-history**: Smoking status, alcohol use, employment
- **survey**: Pain scores, depression screening

### Common Condition Codes
| Condition | SNOMED Code | Description |
|-----------|-------------|-------------|
| Hypertension | 59621000 | Essential hypertension |
| Diabetes Type 2 | 44054006 | Type 2 diabetes mellitus |
| Hyperlipidemia | 55822004 | Hyperlipidemia |
| Asthma | 195967001 | Asthma |
| Depression | 370143000 | Major depression |

### Common Medication Codes
| Medication | RxNorm Code | Description |
|------------|-------------|-------------|
| Lisinopril | 314076 | ACE inhibitor |
| Metformin | 860975 | Diabetes medication |
| Atorvastatin | 259255 | Statin |
| Albuterol | 847728 | Bronchodilator |
| Sertraline | 312940 | Antidepressant |

## üìù Sample Test Scenarios

### 1. Patient Summary Test
```python
# Get a patient with rich clinical data
patient_id = "123"  # Use actual ID from check_synthea_resources.py

# Fetch patient demographics
patient = await fhir_service.get_resource("Patient", patient_id)

# Fetch clinical data
conditions = await fhir_service.search("Condition", {"patient": patient_id})
medications = await fhir_service.search("MedicationRequest", {"patient": patient_id, "status": "active"})
observations = await fhir_service.search("Observation", {"patient": patient_id, "category": "vital-signs", "_count": 10})
```

### 2. Chart Review Test
```python
# Test problem list
conditions = await fhir_service.search("Condition", {
    "patient": patient_id,
    "clinical-status": "active"
})

# Test medication list
medications = await fhir_service.search("MedicationRequest", {
    "patient": patient_id,
    "status": "active,completed"
})

# Test recent labs
labs = await fhir_service.search("Observation", {
    "patient": patient_id,
    "category": "laboratory",
    "date": "ge2024-01-01",
    "_sort": "-date"
})
```

### 3. Orders Module Test
```python
# Test medication orders
med_orders = await fhir_service.search("MedicationRequest", {
    "patient": patient_id,
    "intent": "order",
    "status": "active"
})

# Test diagnostic orders
diag_orders = await fhir_service.search("ServiceRequest", {
    "patient": patient_id,
    "status": "active,completed"
})
```

## üöÄ Quick Data Validation

To quickly check what data is available:

```bash
# Basic check
docker exec emr-backend python scripts/testing/check_synthea_resources.py

# Detailed validation
docker exec emr-backend python scripts/testing/validate_fhir_data.py

# Check specific patient
docker exec emr-backend python scripts/testing/validate_fhir_data.py --patient [PATIENT_ID]
```

## ‚ö†Ô∏è Important Notes

### Data Limitations
1. **Imaging Studies**: ImagingStudy resources are created but don't have DICOM files by default
   - Run DICOM generation: `docker exec emr-backend python scripts/active/generate_dicom_for_studies.py`

2. **Provider Assignments**: Patients may not be assigned to specific providers by default
   - Run assignment: `docker exec emr-backend python scripts/setup/assign_patients_to_providers.py`

3. **Search Parameters**: Must be indexed after data import
   - Verify: `docker exec emr-backend python scripts/monitor_search_params.py`
   - Fix: `docker exec emr-backend python scripts/consolidated_search_indexing.py --mode fix`

4. **Compartments**: Required for Patient/$everything operations
   - Populate: `docker exec emr-backend python scripts/populate_compartments.py`

### Data Quality Considerations
- Synthea generates realistic but synthetic data
- Some clinical scenarios may be simplified
- Temporal relationships are realistic but may not reflect complex care patterns
- Reference ranges for labs are included but may need enhancement

## üìö Additional Resources

- [Synthea Wiki](https://github.com/synthetichealth/synthea/wiki)
- [FHIR R4 Specification](https://hl7.org/fhir/R4/)
- [FHIR Search Parameters](https://hl7.org/fhir/R4/search.html)
- [WintEHR Clinical Modules](../../docs/modules/)